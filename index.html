<!DOCTYPE html><html>
<head>
	<title>Futoshiki Solver</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<link rel="shortcut icon" href="favicon.ico">
</head>

<body><center>

	<table style="position:absolute; left:10px; top:10px; background-color:black;">
		<td>
			<a href="#popup1"><img title="Information" src="../jdgmiles.github.io/questionmark.png" style="width:60px; height:60px"></a><br>
			<a href="https://twitter.com/jimdgmiles" target=blank_><img title="James Miles on Twitter" src="../jdgmiles.github.io/twitter.png" style="width:60px; height:60px"></a><br>
			<a href="http://jdgmiles.github.io/" target="_blank"><img title="Projects Page" src="../jdgmiles.github.io/jdgm.png" style="width:60px; height:60px"></a><br>
		</td>
	</table>

	<div id="popup1" class="overlay">
		<div class="popup">
			<a class="close" style="right: 30px;" href="#">&times;</a>
			<div style="font-family:Georgia; color:white; text-align:center; text-decoration:underline; font-size:45px">Futoshiki Solver</div>
			<span style="font-family:Georgia; font-size:30px; color:white; text-align:justify;"><br>This is a solver for 4x4<a target="_blank" href="https://en.wikipedia.org/wiki/Futoshiki">Futoshiki</a> puzzles.<br><br>Click a cell to insert a number clue and click between two cells to insert an inequality clue.<br><br>When you are ready, click &ldquo;Solve&rdquo;.<br><br></span>
		</div>
	</div>

	<table style="padding:0px 80px 0px 80px; min-width:600px;">
		<tr>
			<td class="numbercell" id="numbercell1" onclick="cellclick(1)"></td>
			<td class="hinequality" id="hin1" onclick="hin(1)"></td>
			<td class="numbercell" id="numbercell2" onclick="cellclick(2)"></td>
			<td class="hinequality" id="hin2" onclick="hin(2)"></td>
			<td class="numbercell" id="numbercell3" onclick="cellclick(3)"></td>
			<td class="hinequality" id="hin3" onclick="hin(3)"></td>
			<td class="numbercell" id="numbercell4" onclick="cellclick(4)"></td>
		</tr>
		<tr>
			<td class="vinequality" id="vin1" onclick="vin(1)"></td>
			<td class="spacer"></td>
			<td class="vinequality" id="vin2" onclick="vin(2)"></td>
			<td class="spacer"></td>
			<td class="vinequality" id="vin3" onclick="vin(3)"></td>
			<td class="spacer"></td>
			<td class="vinequality" id="vin4" onclick="vin(4)"></td>
		</tr>
		<tr>
			<td class="numbercell" id="numbercell5" onclick="cellclick(5)"></td>
			<td class="hinequality" id="hin4" onclick="hin(4)"></td>
			<td class="numbercell" id="numbercell6" onclick="cellclick(6)"></td>
			<td class="hinequality" id="hin5" onclick="hin(5)"></td>
			<td class="numbercell" id="numbercell7" onclick="cellclick(7)"></td>
			<td class="hinequality" id="hin6" onclick="hin(6)"></td>
			<td class="numbercell" id="numbercell8" onclick="cellclick(8)"></td>
		</tr>
		<tr>
			<td class="vinequality" id="vin5" onclick="vin(5)"></td>
			<td class="spacer"></td>
			<td class="vinequality" id="vin6" onclick="vin(6)"></td>
			<td class="spacer"></td>
			<td class="vinequality" id="vin7" onclick="vin(7)"></td>
			<td class="spacer"></td>
			<td class="vinequality" id="vin8" onclick="vin(8)"></td>
		</tr>
		<tr>
			<td class="numbercell" id="numbercell9" onclick="cellclick(9)"></td>
			<td class="hinequality" id="hin7" onclick="hin(7)"></td>
			<td class="numbercell" id="numbercell10" onclick="cellclick(10)"></td>
			<td class="hinequality" id="hin8" onclick="hin(8)"></td>
			<td class="numbercell" id="numbercell11" onclick="cellclick(11)"></td>
			<td class="hinequality" id="hin9" onclick="hin(9)"></td>
			<td class="numbercell" id="numbercell12" onclick="cellclick(12)"></td>
		</tr>
		<tr>
			<td class="vinequality" id="vin9" onclick="vin(9)"></td>
			<td class="spacer"></td>
			<td class="vinequality" id="vin10" onclick="vin(10)"></td>
			<td class="spacer"></td>
			<td class="vinequality" id="vin11" onclick="vin(11)"></td>
			<td class="spacer"></td>
			<td class="vinequality" id="vin12" onclick="vin(12)"></td>
		</tr>
		<tr>
			<td class="numbercell" id="numbercell13" onclick="cellclick(13)"></td>
			<td class="hinequality" id="hin10" onclick="hin(10)"></td>
			<td class="numbercell" id="numbercell14" onclick="cellclick(14)"></td>
			<td class="hinequality" id="hin11" onclick="hin(11)"></td>
			<td class="numbercell" id="numbercell15" onclick="cellclick(15)"></td>
			<td class="hinequality" id="hin12" onclick="hin(12)"></td>
			<td class="numbercell" id="numbercell16" onclick="cellclick(16)"></td>
		</tr>
	</table>
	<table>
		<tr>
		<td colspan="7"><center><br><br>
			<button class="solvebutton" id="solvebutton" onclick="if(badgrid==0){solve();} else{resetgrid();}"><span style="font-size:60px">Solve<span></button>
		</center></td></tr>
	</table>

	<div id="picknumber" class="pickingtable" style="visibility:hidden; position:absolute; top:0px; left:0px;">
		<table style="background-color:gray; border-radius:10px;">
			<tr style="vertical-align:middle;">
				<td onClick="numberpicked(1)"; class="pickingcell"><div class="pickingcellcontent">1</div></td>
				<td onClick="numberpicked(2)"; class="pickingcell"><div class="pickingcellcontent">2</div></td>
				<td onClick="numberpicked(3)"; class="pickingcell"><div class="pickingcellcontent">3</div></td>
			</tr>
			<tr style="vertical-align:middle;">
				<td onClick="numberpicked(4)"; class="pickingcell"><div class="pickingcellcontent">4</div></td>
				<td onClick="numberpicked(0)"; class="pickingcell"><div class="pickingcellcontent"></div></td>
			</tr>
		</table>
	</div>

</center></body>
</html>

<script type="text/javascript">

var hinequalitystate=[];
for(i=0; i<13; i++){hinequalitystate[i]=0;}
var vinequalitystate=[];
for(i=0; i<13; i++){vinequalitystate[i]=0;}
var editedcell=0;
var numbercellstate=[];
for(i=0; i<17; i++){numbercellstate[i]="0";}
var possibles=[];
for(i=0; i<17; i++){
	possibles[i]=[];
	possibles[i][0]=0;
	for(j=1; j<5; j++){possibles[i][j]=1;}
}
var possiblescount=0;
var possiblesvalue=0;
var progress=1;
var inbarrier=0;
var badgrid=0;
var filledcount=0;
var guessingmode=0;
var guesstrials=0;
var guesstrialslimit=500;
var randomcell=0;
var randomvalue=0;
var loopescape=0;

function hin(n){
	hinequalitystate[n]=(hinequalitystate[n]+1)%3;
	if(hinequalitystate[n]==0){document.getElementById("hin"+n).innerHTML="";}
	if(hinequalitystate[n]==1){document.getElementById("hin"+n).innerHTML="<";}
	if(hinequalitystate[n]==2){document.getElementById("hin"+n).innerHTML=">";}
	checkvalid();
}

function vin(n){
	vinequalitystate[n]=(vinequalitystate[n]+1)%3;
	if(vinequalitystate[n]==0){document.getElementById("vin"+n).innerHTML="";}
	if(vinequalitystate[n]==1){document.getElementById("vin"+n).innerHTML="&#8897;";}
	if(vinequalitystate[n]==2){document.getElementById("vin"+n).innerHTML="&#8896;";}
	checkvalid();
}

function cellclick(n){
	document.getElementById("picknumber").style.visibility="visible";
  document.getElementById("picknumber").style.left=(event.clientX+10)+"px";
  document.getElementById("picknumber").style.top=(event.clientY+10)+"px";
	editedcell=n;
}

function numberpicked(n){
	fillcell(editedcell, n);
	document.getElementById("picknumber").style.visibility="hidden";
	checkvalid();
}

function checkvalid(){
	badgrid=0;

	for(p=1; p<17; p++){

		document.getElementById("numbercell"+p).style.backgroundColor="white";

		if(numbercellstate[p]!=0){ // check for contradiction in column
			for(i=0; i<4; i++){
				if(p != ((p-1)%4)+(4*i)+1 && numbercellstate[((p-1)%4)+(4*i)+1]==numbercellstate[p]){
					badgrid=1; document.getElementById("numbercell"+p).style.backgroundColor="red";
				}
			}
		}

		if(numbercellstate[p]!=0){ // check for contradiction in row
			for(i=1; i<5; i++){
				if(p != (4*Math.floor((p-1)/4))+i && numbercellstate[(4*Math.floor((p-1)/4))+i]==numbercellstate[p]){
					badgrid=1; document.getElementById("numbercell"+p).style.backgroundColor="red";
				}
			}
		}
	}

	for(p=1; p<13; p++){ // check for contradiction in horizontal inequality
		if(p%4!=0){document.getElementById("hin"+p).style.color="white";}

		if(hinequalitystate[p]==1 && numbercellstate[p]>=numbercellstate[p+1] && numbercellstate[p+1]!=0){
			badgrid=1;
			document.getElementById("hin"+p).style.color="red";
		}
		if(hinequalitystate[p]==2 && numbercellstate[p]<=numbercellstate[p+1] && numbercellstate[p]!=0){
			badgrid=1;
			document.getElementById("hin"+p).style.color="red";
		}
	}

	for(p=1; p<13; p++){ // check for contradiction in vertical inequality
		document.getElementById("vin"+p).style.color="white";

		if(vinequalitystate[p]==1 && numbercellstate[p]<=numbercellstate[p+4] && numbercellstate[p]!=0){
			badgrid=1;
			document.getElementById("vin"+p).style.color="red";
		}
		if(vinequalitystate[p]==2 && numbercellstate[p]>=numbercellstate[p+4] && numbercellstate[p+4]!=0){
			badgrid=1;
			document.getElementById("vin"+p).style.color="red";
		}
	}

	if(badgrid==1){document.getElementById("solvebutton").innerHTML="<span style=\"font-size:47px\">Bad Input &#9785;</span>";}
	if(badgrid==0){document.getElementById("solvebutton").innerHTML="<span style=\"font-size:60px\">Solve</span>";}

}

function fillcell(cellnumber, fillnumber){
	numbercellstate[cellnumber]=fillnumber;
	if(fillnumber==0){document.getElementById("numbercell"+cellnumber).innerHTML="";}
	else{
		for(i=1; i<5; i++){possibles[cellnumber][i]=0;}
		possibles[cellnumber][fillnumber]=1;
		document.getElementById("numbercell"+cellnumber).innerHTML=fillnumber;
	}
}

function solve(){
	for(i=1; i<17; i++){for(j=1; j<5; j++){possibles[i][j]=1;}} // resets all "possibles"
	for(j=1; j<17; j++){if(numbercellstate[j]!=0){fillcell(j, numbercellstate[j]);}} // refills all starting cells to remove their redundant "possibles"
	solvestep();
	while(progress!=0 && badgrid==0){solvestep();}

	if(badgrid==1 && guessingmode==1){
		guesstrials++; if(guesstrials<guesstrialslimit){resetgrid(); loadgrid(savedgrid); solve();}
	}

	filledcount=0;
	for(p=1; p<17; p++){if(numbercellstate[p]!="0"){filledcount++;}}

	if(filledcount!=16 && badgrid==0){
		if(guessingmode==0){
			savedgrid="";
			for(p=0; p<16; p++){
				savedgrid=savedgrid+numbercellstate[p+1];
			}
			for(p=1; p<16; p++){
				savedgrid=savedgrid+hinequalitystate[p];
			}
			for(p=1; p<13; p++){
				savedgrid=savedgrid+vinequalitystate[p];
			}
			guessingmode=1;
		}
		randomcell=Math.floor((Math.random()*16))+1;
		while(numbercellstate[randomcell]!=0){randomcell=(randomcell%16)+1;}
		randomvalue=Math.floor((Math.random()*4))+1;
		loopescape=0;
		while(possibles[randomcell][randomvalue]!=1 && loopescape<4){randomvalue=(randomvalue%4)+1; loopescape++;}
		if(loopescape<4){fillcell(randomcell, randomvalue); progress=1; solve();}
		else{guesstrials++; if(guesstrials<guesstrialslimit){resetgrid(); loadgrid(savedgrid); solve();}}
	}
}

function solvestep(){
	progress=0;

	for(p=1; p<17; p++){ // fills cells that have only one possibility
		if(numbercellstate[p]==0){
			possiblescount=0;
			possiblesvalue=0;
			for(j=1; j<5; j++){
				if(possibles[p][j]==1){possiblescount++; possiblesvalue=j;}
			}
			if(possiblescount==1){fillcell(p, possiblesvalue); progress++;}
		}
	}

	for(p=1; p<17; p++){ // removes possibilities in same columns as filled cells
		if(numbercellstate[p]!=0){
			for(i=0; i<4; i++){
				if(p != ((p-1)%4)+(4*i)+1 && possibles[((p-1)%4)+(4*i)+1][numbercellstate[p]]!=0){ // note: needs the second condition otherwise will record progress when there wasn't any
					possibles[((p-1)%4)+(4*i)+1][numbercellstate[p]]=0;
					progress++;
				}
			}
		}
	}

	for(p=1; p<17; p++){ // removes possibilities in same rows as filled cells.
		if(numbercellstate[p]!=0){
			for(i=1; i<5; i++){
				if(p != (4*Math.floor((p-1)/4))+i && possibles[(4*Math.floor((p-1)/4))+i][numbercellstate[p]]!=0){ // note: needs the second condition otherwise will record progress when there wasn't any
					possibles[(4*Math.floor((p-1)/4))+i][numbercellstate[p]]=0;
					progress++;
				}
			}
		}
	}

	for(p=1; p<5; p++){ // fills cell if one of its possibles is unique for its column.
		for(j=1; j<5; j++){ // column number (1-indexed)
			possiblescount=0;
			possiblesvalue=0;
			for(k=0; k<4; k++){ // row number (0-indexed)
				if(possibles[j+(4*k)][p]==1){
					possiblescount++;
					possiblesvalue=j+(4*k);
				}
			}
			if(possiblescount==1 && numbercellstate[possiblesvalue]==0){fillcell(possiblesvalue, p); progress++;}
		}
	}

	for(p=1; p<5; p++){ // fills cell if one of its possibles is unique for its row.
		for(k=0; k<4; k++){ // row number (0-indexed)
			possiblescount=0;
			possiblesvalue=0;
			for(j=1; j<5; j++){ // column number (1-indexed)
				if(possibles[j+(4*k)][p]==1){
					possiblescount++;
					possiblesvalue=j+(4*k);
				}
			}
			if(possiblescount==1 && numbercellstate[possiblesvalue]==0){fillcell(possiblesvalue, p); progress++;}
		}
	}

	for(p=1; p<17; p++){ // performs horizontal inequality deductions

		if(hinequalitystate[p]==1){

			for(i=4; i>0; i--){
				if(possibles[p][i]==1){inbarrier=i;} // finds lowest possible in left cell
			}
			for(i=1; i<inbarrier+1; i++){
				if(possibles[p+1][i]==1){possibles[p+1][i]=0; progress++;} // removes possibles from right cell below or equal to that lowest possible in left cell
			}

			for(i=1; i<5; i++){
				if(possibles[p+1][i]==1){inbarrier=i;} // finds highest possible in right cell
			}
			for(i=inbarrier; i<5; i++){
				if(possibles[p][i]==1){possibles[p][i]=0; progress++;} // removes possibles from left cell greater or equal to that highest possible in right cell
			}
		}

		if(hinequalitystate[p]==2){

			for(i=4; i>0; i--){
				if(possibles[p+1][i]==1){inbarrier=i;} // finds lowest possible in right cell
			}
			for(i=1; i<inbarrier+1; i++){
				if(possibles[p][i]==1){possibles[p][i]=0; progress++;} // removes possibles from left cell below or equal to that lowest possible in right cell
			}

			for(i=1; i<5; i++){
				if(possibles[p][i]==1){inbarrier=i;} // finds highest possible in left cell
			}
			for(i=inbarrier; i<5; i++){
				if(possibles[p+1][i]==1){possibles[p+1][i]=0; progress++;} // removes possibles from right cell greater or equal to that highest possible in left cell
			}
		}

	}

	for(p=1; p<13; p++){ // performs vertical inequality deductions

		if(vinequalitystate[p]==1){

			for(i=4; i>0; i--){
				if(possibles[p+4][i]==1){inbarrier=i;} // finds lowest possible in bottom cell
			}
			for(i=1; i<inbarrier+1; i++){
				if(possibles[p][i]==1){possibles[p][i]=0; progress++;} // removes possibles from top cell below or equal to that lowest possible in bottom cell
			}

			for(i=1; i<5; i++){
				if(possibles[p][i]==1){inbarrier=i;} // finds highest possible in top cell
			}
			for(i=inbarrier; i<5; i++){
				if(possibles[p+4][i]==1){possibles[p+4][i]=0; progress++;} // removes possibles from bottom cell greater or equal to that highest possible in top cell
			}
		}

		if(vinequalitystate[p]==2){

			for(i=4; i>0; i--){
				if(possibles[p][i]==1){inbarrier=i;} // finds lowest possible in top cell
			}
			for(i=1; i<inbarrier+1; i++){
				if(possibles[p+4][i]==1){possibles[p+4][i]=0; progress++;} // removes possibles from bottom cell below or equal to that lowest possible in top cell
			}

			for(i=1; i<5; i++){
				if(possibles[p+4][i]==1){inbarrier=i;} // finds highest possible in bottom cell
			}
			for(i=inbarrier; i<5; i++){
				if(possibles[p][i]==1){possibles[p][i]=0; progress++;} // removes possibles from top cell greater or equal to that highest possible in bottom cell
			}
		}

	}
	checkvalid();

}

function loadgrid(n){
	guessingmode=0;
	for(p=0; p<16; p++){
		fillcell(p+1, n[p]);
	}

	for(p=16; p<32; p++){
		if((p-15)%4 != 0){
			hinequalitystate[p-15]=n[p];
			if(hinequalitystate[p-15]==0){document.getElementById("hin"+(p-15)).innerHTML="";}
			if(hinequalitystate[p-15]==1){document.getElementById("hin"+(p-15)).innerHTML="<";}
			if(hinequalitystate[p-15]==2){document.getElementById("hin"+(p-15)).innerHTML=">";}
		}
	}

	for(p=32; p<48; p++){
		vinequalitystate[p-31]=n[p];
		if(vinequalitystate[p-31]==0){document.getElementById("vin"+(p-31)).innerHTML="";}
		if(vinequalitystate[p-31]==1){document.getElementById("vin"+(p-31)).innerHTML="&#8897;";}
		if(vinequalitystate[p-31]==2){document.getElementById("vin"+(p-31)).innerHTML="&#8896;";}
	}

}

function resetgrid(){
	loadgrid("0000000000000000000000000000000000000000");
	checkvalid();
}


</script>
